---
layout: post
title: 《王道程序员面试宝典》笔记 - 第3章 结构体、共用体与枚举
author: 宋强
tags: c++ 笔试 笔记
---

### struct和class在c++中的不同 <span>struct的元素默认为public，而class的元素默认为private，其他的并没有不同。</span>

### 快速判断是大端还是小端 <span>下面两个函数都是一个道理，大端就是高字节存高地址，小端就是高字节存低地址。</span>
```c++
#define BIG_ENDIAN 0
#define LITTLE_ENDIAN 1
int TestByteOrder() {
        short int word = 0x1;
        char *byte = (char *)word;
        return (byte[0] ? LITTLE_ENDIAN : BIG_ENDIAN);
}

int testByteOrder() {
        Union testUnion {
                int i;
                unsigned char[]
        }testUnit;
        testUnit.i = 0x1;
        return (byte[0] ? LITTLE_ENDIAN: BIG_ENDIAN);
}
```

### C语言参数的入栈顺序 <span>C语言参数入栈顺序为从右至左，这是由于C语言需要支持不定数目参数决定的。</span>

### C语言的栈 <span>栈顶为低地址，栈底为高地址。</span>

### 位域数据存放的基本原则
1. 低字节都放在低地址。
2. 大端模式先为MSB配空间，小段模式先为LSB分配空间。
3. 大端模式高地址存放高bit（每个bit域中），小段模式相反。
例，如何推算大小端模式下位域在内存中的分布：
```c++
struct {
        short bit1:4;
        short bit2:9;
        short bit3:3;
};
```
第一步，先按大端模式推算，内存中即为：

|           |             |             |           |
|-----------|-------------|-------------|-----------|
| bit1(4位，$a_0a_1a_2a_3$) | bit2(高4位$a_5a_6a_7a_8$) | bit2(低5位$a_0a_1a_2a_3a_4$) | bit3(3位$a_0a_1a_2$) |

高4位低5位分布是遵循原则2，内部分布遵循原则3。

第二步，开始计算小端，按照原则3，将每个bit域中的内部序列分布调换，变为

|           |             |             |           |
|-----------|-------------|-------------|-----------|
| bit1($a_3a_2a_1a_0$) | bit2($a_8a_7a_6a_5$) | bit2($a_4a_3a_2a_1a_0$) | bit3($a_2a_1a_0$) |

第三步，按照原则2，小端模式会先为LSB元素分配空间，所以bit2中变为先分配低4位，再分配高5位

|           |             |             |           |
|-----------|-------------|-------------|-----------|
| bit1($a_3a_2a_1a_0$) | bit2($a_3a_2a_1a_0$) | bit2($a_8a_7a_6a_5a_4$) | bit3($a_2a_1a_0$) |

第四步，交换每个字节内部cell顺序，例如第一个字节就是交换bit1 4位和bit2高四位， 变为

|           |             |             |           |
|-----------|-------------|-------------|-----------|
| bit2($a_3a_2a_1a_0$) | bit1($a_3a_2a_1a_0$) | bit3($a_2a_1a_0$) | bit2($a_8a_7a_6a_5a_4$) |

可使用$P_{44}$例5验证。

